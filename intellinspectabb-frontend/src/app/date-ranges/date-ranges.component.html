<div class="container">
  <h1>Date Range Selection</h1>
  <p>Step 2 of 4</p>

  <!-- This div will only show up if the timestamps are successfully set in ngOnInit -->
  <div *ngIf="earliestTimestamp && latestTimestamp">
    <p class="info-text">
      Select non-overlapping date ranges for Training, Testing, and Simulation.
      <br>
      Available data from: <strong>{{ earliestTimestamp }}</strong> 
      to <strong>{{ latestTimestamp }}</strong>
    </p>

    <div class="cards-container">
      <!-- Training Period Card -->
      <div class="period-card">
        <h3>Training Period</h3>
        <div class="date-picker">
          <label for="trainStart">Start Date:</label>
          <input type="date" id="trainStart" [(ngModel)]="trainingStart">
        </div>
        <div class="date-picker">
          <label for="trainEnd">End Date:</label>
          <input type="date" id="trainEnd" [(ngModel)]="trainingEnd">
        </div>
      </div>

      <!-- Testing Period Card -->
      <div class="period-card">
        <h3>Testing Period</h3>
        <div class="date-picker">
          <label for="testStart">Start Date:</label>
          <input type="date" id="testStart" [(ngModel)]="testingStart">
        </div>
        <div class="date-picker">
          <label for="testEnd">End Date:</label>
          <input type="date" id="testEnd" [(ngModel)]="testingEnd">
        </div>
      </div>

      <!-- Simulation Period Card -->
      <div class="period-card">
        <h3>Simulation Period</h3>
        <div class="date-picker">
          <label for="simStart">Start Date:</label>
          <input type="date" id="simStart" [(ngModel)]="simulationStart">
        </div>
        <div class="date-picker">
          <label for="simEnd">End Date:</label>
          <input type="date" id="simEnd" [(ngModel)]="simulationEnd">
        </div>
      </div>
    </div>

    <div class="actions">
      <button class="validate-btn" (click)="validateRanges()" [disabled]="isLoading">
        {{ isLoading ? 'Validating...' : 'Validate Ranges' }}
      </button>
      <button class="next-btn" [disabled]="validationResult?.status !== 'Valid'">Next</button>
    </div>

    <!-- Validation message on success -->
    <div *ngIf="validationResult?.status === 'Valid'" class="validation-message success">
      <p>✓ {{ validationResult.message }}</p>
    </div>

    <!-- Validation message on error -->
    <div *ngIf="errorMessage" class="validation-message error">
      <p>✗ {{ errorMessage }}</p>
    </div>

    <!-- Summary cards AFTER successful validation -->
    <div *ngIf="validationResult?.status === 'Valid'" class="summary-grid">
      <div class="summary-card">
        <h4>Training Period</h4>
        <p>{{ validationResult.trainingRecordCount | number }} records</p>
        <span>{{ validationResult.trainingDurationDays }} days</span>
      </div>
      <div class="summary-card">
        <h4>Testing Period</h4>
        <p>{{ validationResult.testingRecordCount | number }} records</p>
        <span>{{ validationResult.testingDurationDays }} days</span>
      </div>
      <div class="summary-card">
        <h4>Simulation Period</h4>
        <p>{{ validationResult.simulationRecordCount | number }} records</p>
        <span>{{ validationResult.simulationDurationDays }} days</span>
      </div>
    </div>

    <!-- Timeline Bar Chart - Shows AFTER successful validation -->
    <div *ngIf="validationResult?.status === 'Valid'" class="chart-container">
        <h3>Selected Date Ranges Summary</h3>
  <ngx-charts-bar-vertical
    [view]="view"
    [results]="chartData"
    [customColors]="customColors"
    [xAxis]="showXAxis"
    [yAxis]="showYAxis"
    [showXAxisLabel]="showXAxisLabel"
    [showYAxisLabel]="showYAxisLabel"
    [xAxisLabel]="xAxisLabel"
    [yAxisLabel]="yAxisLabel"
    (select)="onSelect($event)">
  </ngx-charts-bar-vertical>

    </div>
  </div>
</div>
